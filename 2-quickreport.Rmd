---
title: "Looking for changes in global Rh"
author: "Ben Bond-Lamberty"
date: "1/6/2017"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(broom)
library(ggplot2)
theme_set(theme_bw())
d <- readr::read_csv("outputs/1-prepdata/srdb_filtered.csv")
d <- subset(d, Study_midyear >= 1989)
d$tmp_anom <- d$tmp - d$tmp_norm
d$pre_anom <- d$pre - d$pre_norm
d$pet_anom <- d$pet - d$pet_norm
```

### Background

Our [2010 Nature paper](http://www.nature.com/nature/journal/v464/n7288/full/nature08930.html) concluded by saying yeah, soil respiration (R~S~) is increasing globally, based on an analysis of a soil respiration database (SRDB), **but** we can't distinguish whether this is an acceleration of the C cycle, or a feedback:

>This positive global R~S~ response does not necessarily constitute a positive feedback loop between soil and the atmosphere; it could be driven by higher carbon inputs to soil rather than by mobilization of stored older carbon, as the temperature sensitivity and priming potential of recalcitrant carbon are uncertain. An interesting test is possible here, as a subset of studies using S1 estimated the source fluxes of R~S~. In these partitioned R~S~ data (N=206), the temperature anomaly is significant...on both the autotrophic and heterotrophic components of R~S~. These data are limited and subject to larger errors because of the imprecision in the various methods used to partition R~S~ sources; nonetheless, they suggest that both these R~S~ sources are responding to climate changes.

Seven years later, we have a _lot_ more data, both within the SRDB and from other sources. How can we test whether heterotrophic respiration (R~H~) is in fact increasing? Various lines of evidence:

### 1. R~H~ versus R~S~

R~H~ generally varies in a predictable way with R~S~ ([B-L 2004](http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2486.2004.00816.x/abstract), [Subke 2006](http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2486.2006.01117.x/abstract)). Everything else being equal, we would expect this ratio to change (increase) if soil C is being increasingly mineralized into R~H~.

```{r, echo=FALSE, fig.height=4}
d1 <- subset(d, !is.na(Rh_annual) & !is.na(Rs_annual))
ggplot(d1, aes(Study_midyear, Rh_annual/Rs_annual)) + geom_point() + geom_smooth(method = "lm") + annotate("text", x = 1991, y = 1, label = paste("N =", nrow(d1)))
```

The R~H~/R~S~ ratio seems to be increasing significantly over time:

```{r, echo=FALSE}
m1 <- lm(Rh_annual/Rs_annual ~ Study_midyear + tmp_norm * pre_norm, data=d1)
summary(m1)
```

We can also fit models of the [Bond-Lamberty (2004)](http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2486.2004.00816.x/abstract) form at different time intervals:

```{r, echo=FALSE, fig.height=4}
d1$yeargroup <- cut(d1$Study_midyear, 4)
d1 %>% group_by(yeargroup) %>% mutate(group = paste(yeargroup, "N =", n())) -> d1

qplot(Rs_annual, Rh_annual, data=d1, log="xy", color=group) + geom_smooth(method="lm", se = FALSE)

 # d1 %>%
 #    group_by(yeargroup) %>%
 #    do(mod = lm(log(Rh_annual) ~ log(Rs_annual), data = .)) %>%
 #    tidy(mod) ->
 #    x
```

(Notice that lines later in time are angled more steeply.) So yes, there seem to be continuous increases with time in the relationship between R~H~ and R~S~--i.e., more recent studies exhibit higher ratios. This is what we'd expect to see if R~H~ were increasing due to a climate feedback (SOC loss).

### 2. R~H~ and R~S~ versus GPP

Gross primary production (GPP) is the ultimate source for both the autotrophic and heterotrophic soil surface CO~2~ fluxes, and measured [RS is related to GPP](http://www.biogeosciences.net/7/1915/2010/). If SOC is being increasingly lost, i.e. R~H~ is increasing, we'd expect to see both the R~H~:GPP and R~S~:GPP ratios increase over time.

There are three (?) sources of global GPP data. **The first source** is the [Beer et al. 2010](http://www.sciencemag.org/cgi/content/short/329/5993/834) dataset.

```{r, echo=FALSE, fig.height=4}
d2 <- filter(d, gpp > 0)
d2 %>% 
  select(Study_midyear, Rs_annual, Rh_annual, gpp) %>% 
  gather(flux, value, -Study_midyear, -gpp) %>%
  filter(is.finite(value/gpp), !is.na(value)) %>%
  qplot(Study_midyear, value/gpp, data=., color=flux) + geom_smooth(method = "lm") + coord_cartesian(ylim = c(0,4))

```

```{r, echo=FALSE}
m2 <- lm(Rh_annual/gpp ~ Study_midyear + tmp_norm * pre_norm, data=d2)
summary(m2)
m3 <- lm(Rs_annual/gpp ~ Study_midyear + tmp_norm * pre_norm, data=d2)
summary(m3)
```

Both the R~S~/gpp and R~H~/gpp ratios show increases over time, even after taking into account climate normal effects.

The **second source of GPP data** is the MODIS GPP product. It's only 2000-2015, versus 1982-2011 for Beer, but is a completely independent product.

```{r, echo=FALSE, fig.height=4}
d2modis <- filter(d, modisgpp > 0)
d2modis %>% 
  select(Study_midyear, Rs_annual, Rh_annual, modisgpp) %>% 
  gather(flux, value, -Study_midyear, -modisgpp) %>%
  filter(is.finite(value/modisgpp), !is.na(value)) %>%
  qplot(Study_midyear, value/modisgpp, data=., color=flux) + geom_smooth(method = "lm") + coord_cartesian(ylim = c(0,4))

```

```{r, echo=FALSE}
m2modis <- lm(Rh_annual/modisgpp ~ Study_midyear + tmp_norm * pre_norm, data=d2modis)
summary(m2modis)
m3modis <- lm(Rs_annual/modisgpp ~ Study_midyear + tmp_norm * pre_norm, data=d2modis)
summary(m3modis)
```

The Beer and MODIS GPP data are fairly correlated (R^2^ = ~0.75) so it's not surprising that here, too, both the R~S~/gpp and R~H~/gpp ratios show significant increases over time.

The **third GPP data source** is within the SRDB itself, i.e. as reported by study authors.

```{r, echo=FALSE, fig.height=4}
d %>% 
  filter(!is.na(GPP)) %>%
  select(Study_midyear, Rs_annual, Rh_annual, GPP) %>% 
  gather(flux, value, -Study_midyear, -GPP) %>%
  filter(is.finite(value/GPP), !is.na(value)) %>%
  qplot(Study_midyear, value/GPP, data=., color=flux) + geom_smooth(method = "lm")
```

```{r, echo=FALSE}
m4 <- lm(Rh_annual/GPP ~ Study_midyear + tmp_norm * pre_norm, data=d2)
summary(m4)
m5 <- lm(Rs_annual/GPP ~ Study_midyear + tmp_norm * pre_norm, data=d2)
summary(m5)
```

Not much to see here: the number of data points is relatively small, and lots of noise. No trends.

### 3. Climate effects on R~H~

Following the logic of the 2010 Nature paper, we'd also expect to see climate anomalies associated with higher R~H~ values, relative to the climate-normal baseline.

```{r, echo=FALSE}
m6 <- lm(sqrt(Rh_annual) ~ tmp_norm + tmp_anom + pre_norm + pre_anom + pet_norm + pet_anom + Study_midyear , data=d)
summary(m6)
```

Interestingly, while R~S~ continues to show changes driven by temperature anomalies (not shown), R~H~ is affected by the precip norm (i.e. 1961-1990); the precip anomaly (responding positively); and year (there's a positive trend for unknown reasons). We don't see any temperature effect. This dataset is somewhat larger than the 2010 one (N=`r length(residuals(m6))` now versus 163 then).

### Summary

Test  | N | Result consistent with R~H~ feedback?
------------- |  ------------- | -------------
Increasing R~H~:R~S~ ratio over time  | 207 | Yes
Increasing R~H~:Beer GPP over time  | 215 | Yes
Increasing R~S~:Beer GPP over time  | 1283 | Yes
Increasing R~H~:MODIS GPP over time  | 143 | Yes
Increasing R~S~:MODIS GPP over time  | 783 | Yes
Increasing R~H~:study GPP over time  | 20 | No: no trend
Increasing R~S~:study GPP over time  | 101 | No: no trend
R~H~ trend over time | 190 | Yes

### Caveats and next steps

Caveats:

* Stitching together a bunch of things here--no single one of them is definitive proof. Collectively though, they're suggestive.
* These regression tests are not very sophisticated, and most have very low overall explanatory power (R^2^ values are 0.05-0.25). Lots of 'other' variability.
* Not testing LAI or Ndep (neither necessary?).

Next steps:

* Discuss with Chris.
* Check Hashimoto and Hursh publications re factors affecting global soil fluxes.
* Update the SRDB - in particular, prioritize studies reporting R~H~.
* What other statistical approaches can we bring to bear/apply?
* What other datasets would help more stringent tests?
* Can we compute an implied Q10, or examine whether results are consistent with [Crowther et al. (2016)](http://www.nature.com/nature/journal/v540/n7631/full/nature20150.html)?
* Re the assumption that Rh/GPP would increase with soil loss--does this occur in warming experiments? E.g. Harvard Forest or...?
* Given Crowther et al. results, should include SOC (from soilsgrid1km)
* Experiment with Thiel-Sen trend estimator--sounds like could be appropriate
